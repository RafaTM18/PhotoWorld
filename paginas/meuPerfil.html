<html>

    <script type="text/javascript" src="./scripts/atualizarPerfil.js">  </script>
    <script type="text/javascript" src="./scripts/getPublicacaoDivPerfil.js"></script>
    <script type="text/javascript" src="./scripts/getPublicacoesPerfil.js"></script>
    
    <div class="d-flex bg-gradient-info text-light justify-content-center shadow">
        <div class="container-lg row p-2 ">
            <div class="col-md-2"> 
                <img class="img" id="fotoPerfil" style='overflow:hidden; height: 120px; width: 160px; border-radius: 45%;' src="imgs/undraw_profile.svg"> 
            </div> 
            <div class="col-md-7 d-flex flex-column justify-content-end">
                <p class="h4 my-1" id ='nome'> Nome: <i id='nomeTxt'> </i> </p>
                <p class="h5 my-1" id = 'apelido'> userName: <i id='apelidoTxt'> </i></p>
                <p id = 'dataNascimentoTxt'> 03/01/1990</p>
            </div>
            <div class ="col-md-3 d-flex align-items-center justify-content-center "> <i class=" btn btn-primary fas fa-user-edit p-3" id="editarMeusDados"> Meus dados</i> </div>
        </div>  
    </div>

    <div class="row d-flex mt-3 p-1 justify-content-center  ">
        <div class="container-md bg-gray-200 shadow">
            <div class=" row">    
                <h3>Minhas Publicações</h3>
            </div>
        
            <div class ="row" id ='listaPublicacoes'>
                
            </div>
        </div>
    </div>

    <div class="modal fade" id="editarMeusDadosModal" tabindex="-1" role="dialog" aria-labelledby="Editar dados do Perfil" aria-hidden="true" style = "max-width: 80%; margin:auto auto !important;">
        <div class="modal-dialog modal-md" style = ' overflow-y: initial !important' role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" > Editar meus dados</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style = ' overflow-y: auto !important'>
                    <form id="formMeusDados" class="row d-flex flex-column justify-content-center align-items-center" enctype="multipart/form-data">
                           <div class='col-md-9'>
                               
                            <dt class="col-md-4">userName:</dt>
                            <dd class="col-md-12" ><input type='text' class="form-control" placeholder='Troque seu username' id='txtUserName' name="username"></input></dd>				
                            <dt class="col-md-4">Nome:</dt>
                            <dd class="col-md-12" ><input type='text' class="form-control" placeholder='Errou o próprio nome? Coloque o certo' id='txtNovoNome' name="nome"></input></dd>
                            <dt class="col-md-4">Data Nascimento:</dt>
                            <dd class="col-md-12" ><input type='text' class="form-control" placeholder='Em que dia você nasceu? ' id='txtNovaDataNascimento' name="dtNasc"></input></dd>
                            <dt class="col-md-4">Foto de Perfil:</dt>
                            <div class="form-group" style="display: none; visibility: hidden;"><input type="text" class="form-control form-control-user" id="id" name="id" > </div>
                            <!-- Trcoar de text para input quando o servidor aceitar fotos-->
                            <dd class="col-md-12" ><input type='file' class="form-control" placeholder='Nova Foto pa ficar bonito!' id='novaFotoPerfil' name="foto"></input></dd>
                            
                        </div>
                        <p  class="col-auto text-primary rp-3 row d-flex flex-column justify-content-center align-items-center" >
                            
                            <i id='btnSalvarDados' class="btn btn-primary fas fa-save  "> Salvar </i>
                            
                        </p>
                        <span class="mt-2" id="result"></span>
                    
                    </form>
                   
                </div>
            </div>
        </div>
        <script>
            function dataFormatada(dataNascimento){
                let data = new Date(dataNascimento),
                    dia  = data.getDate().toString().padStart(2, '0'),
                    mes  = (data.getMonth()+1).toString().padStart(2, '0'),
                    ano  = data.getFullYear();
                return `${dia}/${mes}/${ano}`
            }
            var nomeTxt = document.getElementById('nomeTxt');
            var apelidoTxt = document.getElementById('apelidoTxt');
            var dataNascimentoTxt = document.getElementById('dataNascimentoTxt');
            var fotoPerfil = document.getElementById('fotoPerfil');
            console.log(localStorage.getItem("auth"));
            nomeTxt.innerText = JSON.parse(localStorage.getItem("auth")).nome;
            apelidoTxt.innerText = JSON.parse(localStorage.getItem("auth")).username;
            fotoPerfil.src = JSON.parse(localStorage.getItem("auth")).foto;
            dataNascimentoTxt.innerText = dataFormatada(JSON.parse(localStorage.getItem("auth")).dt_nasc);
    
            document.getElementById('editarMeusDados').addEventListener("click", function(event){
                $('#editarMeusDadosModal').modal('show');	
            });
            document.getElementById('btnSalvarDados').addEventListener("click", function(event){
                document.getElementById("id").value = JSON.parse(localStorage.getItem("auth")).id;
                //alert(atualizarPerfil(new FormData(document.getElementById("formMeusDados"))));
                document.getElementById("result").innerText = atualizarPerfil(new FormData(document.getElementById("formMeusDados")));
            });
            window.onload = getPublicacoesPerfil(document.getElementById("listaPublicacoes"));
        </script>
    
    </div>
    

</html>